:imagesdir: Images
:table-caption: Таблица
:figure-caption: Рисунок
:toc:
:toc-title: ОГЛАВЛЕНИЕ:

== Требования к ПО
--
Авторы работы: Нефедова А.В., Маскаль П.И. гр. КЭ-413.
--
=== Задание к курсовой работе (вариант 8)
--
image::img1.png[]
image::img2.png[]

--
=== 1. Переменный резистор

*Переменный резистор* (или *потенциометр*) - это резистор, у которого электрическое сопротивление между подвижным контактом и выводами резистивного элемента можно изменять механическим способом.

Снимаемое с подвижного отводного контакта потенциометра напряжение может изменяться от нуля до максимального значения, равного приложенному к потенциометру напряжению, в зависимости от текущего положения подвижного контакта.

Величина снимаемого напряжения может как линейно зависеть от перемещения движка, так и логарифмически, поэтому потенциометры подразделяются на *линейные* и *логарифмические* .

.Схема работы переменного резистора
image::img3.png[]

Согласно схеме платы расширения переменный резистор находится на линии *PA0* и имеет номинал *10 кОм*.

.Потенциометр на схеме
image::img4.png[]

Предположим, что на нашей плате стоит переменный резистор с линейной функцией преобразования.

Формула для расчета напряжения, получаемого с АЦП:

image::img5.png[]

image::img10.png[]


=== 2. Аналого-цифровой преобразователь

*Аналого-цифровой преобразователь* – устройство, которое принимает аналоговые сигналы и генерирует соответствующий им цифровой код, пригодный для дальнейшей обработки микропроцессором или другим цифровым устройством.

Сперва АЦП преобразует аналоговый сигнал в дискретный, чтобы разбить измеряемый диапазон на какое-то конечное количество значений. Такой процесс называется *квантованием*.

*Основными характеристиками* АЦП можно назвать *частоту преобразования*, которая выражается в отсчетах в секунду (samples per second) и *разрядность* (количество шагов) – в битах.

Почти во всех микроконтроллерах STM32, АЦП выполнено по схеме 12-битного АЦП последовательного приближения (SAR ADC), структурная схема которая показана на рисунке 3.

.Структурная схема АЦП последовательного приближения
image::img6.png[]

* Он включает в себя компаратор, регистр последовательного приближения (SAR), цифро-аналоговый преобразователь (ЦАП).
* Регистр последовательного приближения осуществляет алгоритм последовательного приближения, генерируя текущее значение кода, подающегося на вход ЦАП, на основе которого ЦАП генерирует выходное напряжение.
* Компаратор сравнивает значение входного сигнала с сигналом выхода ЦАП.
Данный вид преобразователя измеряет величину входного сигнала, осуществляя ряд последовательных «взвешиваний» (сравнений) измеряемой величины с 1/2, 1/4, 1/8, и т.д. от ее возможного максимального значения.
* Допустим, что сигнал находится в интервале (0 – Uоп), тогда с приходом первого тактового импульса регистра последовательного приближения на выходе встроенного ЦАП устанавливается величина, равная половине Uоп. Если сигнал превышает эту величину, тогда его сравнивают с напряжением 3/4 Uоп, которое находится посередине оставшегося интервала. Если сигнал меньше установленного уровня, то следующее сравнение будет производиться с меньшей половиной оставшегося интервала (т.е. с уровнем 1/4 Uоп). Такое сравнение повторяется N раз и на выходе получается N бит результата.

*Основные параметры АЦП*, используемого в данной работе:

* Напряжение питания: *Vdd* = 1,7 - 3,6 В (стндартное значение Vdd = 3,3 В);
* Опорное напряжение: *Vref* = 1,7 - Vdd;

.Точность АЦП для 30 МГц
[options="header"]
|=====================
|Обозначение|Параметр                          |Значение        |Единицы измерения
|ET         |Общая нескорректированная ошибка  |От ±2 до ±5     |LSB
|EO         |Ошибка смещения                   |От ±1,5 до ±2,5 |LSB
|EG         |Ошибка усиления                   |От ±1,5 до ±4   |LSB
|ED         |Ошибка дифференциальной линейности|От ±1 до ±2     |LSB
|EL         |Ошибка интегральной линейности    |От ±1,5 до ±3   |LSB
|=====================

.Характеристика точности АЦП
image::img7.png[]

* Основную часть погрешности преобразования аналогового сигнала в цифровой код составляет погрешность АЦП, которая определяется погрешностью квантования. Погрешность квантования равна весу младшего разряда и вычисляется по формуле:

image::img9.png[]

* Определим погрешность квантования

image::img8.png[]

* Определим приведенную погрешность АЦП:

image::img11.png[]

==== 3. Механизм DMA для получения кода измерения

Прямой доступ к памяти (DMA) используется для обеспечения высокоскоростной передачи данных между периферийными устройствами и памятью.

Каждая передача DMA состоит из трех операций:

* Загрузка данных из регистра периферийного модуля или адреса в
памяти через внутренний регистр.
* Сохранение данных, загруженных во внутренний регистр в
указанное место. Им может быть периферийный модуль или адрес
в памяти.
* Увеличение адресов источника и приемника при необходимости.


Наше устройство оснащено двумя двухпортовыми DMA общего назначения (DMA1 и DMA2) с 8 каналами каждый. Оба канала DMA сидят на шине AHB1 и перед тем как начать с ним работать надо на него подать тактирование, подняв биты DMA1EN и DMA2EN в регистре RCC_AHB1ENR

image::img13.png[]

.Таблица каналов DMA2
image::img12.png[]

==== 4. Цифровой фильтр

В задании нужно реализовать фильтр, для которого создадим новый класс с входной и выходной величиной.

image::img14.png[]

==== 5. Передача значений по беспроводному интерфейсу Bluetooth Bee HC-06

*Bluetooth* – это спецификация беспроводных персональных сетей (стандарт IEEE 802.15.1). Принцип действия основан на использовании радиоволн. Радиосвязь Bluetooth осуществляется в ISM-диапазоне, который используется в различных бытовых приборах и беспроводных сетях (свободный от лицензирования диапазон 2,4-2,4835 ГГц).

Основными преимуществами Bluetooth по сравнению с конкурирующими решениями являются низкий уровень энергопотребления и невысокая стоимость приемопередатчиков, что позволяет применять его даже в малогабаритных устройствах с миниатюрными элементами питания.

Основная функция модуля *Bluetooth* - это организация связи по
последовательному интерфейсу там, где ранее для связи применялась кабельная
линия.

Параметры модуля *Bluetooth Bee HC-06*:

* скорость по умолчанию — 9600,
* диапазон установки — 4800 кГц - 1.3 MГц.

.Распиновка и размеры модуля *Bluetooth Bee HC-06*
image::img15.png[]

.Описание контактов
[options="header"]
|=====================
|Контакт|Описание
|PIN1   |Передача UART_TXD , уровень ТТЛ/КМОП, вывод данных UART
|PIN2   |Прием UART_RXD, уровень ТТЛ/КМОП, ввод данных UART
|PIN11  |Сброс модуля. Подача низкого уровня на контакт приведёт к сбросу.
|PIN12  |VCC, напряжение питания. Стандартный уровень напряжения составляет 3,3 В, диапазон возможных значений 3,0 - 4,2 В
|PIN13  |GND, заземление
|PIN22  |GND, заземление
|PIN24  |LED, Светодиод, индикатор рабочего режима.

Ведомое устройство: До установления связи контакт выдаёт прямоугольный сигнал с периодом в 102 мс. После установки связи контакт выдаёт высокий уровень.

Ведущее устройство: Если в памяти нет записи о соединяемом устройстве, то на выходе будет прямоугольный сигнал с периодом 110мс. Если в памяти устройство есть — период составляет 750мс.

После установления соединения контакт выдаёт высокий уровень.
|PIN26  |В случае ведущего устройства контакт обнуляет информацию о запоминаемых устройствах. После обнуления ведущее устройство будет искать ведомое случайным образом. Адрес нового устройства будет записан в память, и в следующий раз в поиске будет только оно.
|=====================


